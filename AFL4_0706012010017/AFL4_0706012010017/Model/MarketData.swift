//
//  MarketData.swift
//  AFL4_0706012010017
//
//  Created by MacBook Pro on 05/06/22.
//

import Foundation
import UIKit

//JSON DATA
/*
 URL: https://api.coingecko.com/api/v3/global
 
 JSON Response:
 {
   "data": {
     "active_cryptocurrencies": 13476,
     "upcoming_icos": 0,
     "ongoing_icos": 49,
     "ended_icos": 3376,
     "markets": 634,
     "total_market_cap": {
       "btc": 43145557.768694475,
       "eth": 717935323.253789,
       "ltc": 20426854790.89404,
       "bch": 6837405599.981015,
       "bnb": 4305833989.737253,
       "eos": 1011620831453.6936,
       "xrp": 3242440181265.676,
       "xlm": 8835049872787.719,
       "link": 175253310046.44498,
       "dot": 137410475091.91844,
       "yfi": 173336918.89564627,
       "usd": 1279440471321.165,
       "aed": 4699512795209.773,
       "ars": 154394355005499.1,
       "aud": 1775178873541.6223,
       "bdt": 114137643389304.14,
       "bhd": 483265137065.54614,
       "bmd": 1279440471321.165,
       "brl": 6109328250558.563,
       "cad": 1611544834462.001,
       "chf": 1230510829376.428,
       "clp": 1038662569023235.8,
       "cny": 8521457371140.361,
       "czk": 29438773748675.812,
       "dkk": 8877653598356.182,
       "eur": 1193619442826.356,
       "gbp": 1024495324684.2968,
       "hkd": 10036954609420.273,
       "huf": 467801819529158.75,
       "idr": 18466804042814036,
       "ils": 4273355483581.648,
       "inr": 99404080314543.89,
       "jpy": 167408388470017.66,
       "krw": 1601258133072579.2,
       "kwd": 391863189234.83264,
       "lkr": 462139811815061.1,
       "mmk": 2373513988665121.5,
       "mxn": 25006855928042.86,
       "myr": 5618023109571.226,
       "ngn": 532009267818580.5,
       "nok": 12073376035598.605,
       "nzd": 1938688806895.5227,
       "php": 67695188940400.55,
       "pkr": 253503918359068.6,
       "pln": 5478883958315.0625,
       "rub": 81065355939551.92,
       "sar": 4798752595367.8125,
       "sek": 12202452387547.844,
       "sgd": 1757912824381.141,
       "thb": 43876965196226.766,
       "try": 21005341881962.34,
       "twd": 37583563845059.22,
       "uah": 37689051153038.73,
       "vef": 128110374393.38826,
       "vnd": 29683018934651028,
       "zar": 19887014951992.324,
       "xdr": 930786545683.7891,
       "xag": 58342127248.91308,
       "xau": 691179331.4171201,
       "bits": 43145557768694.48,
       "sats": 4314555776869447.5
     },
     "total_volume": {
       "btc": 1389985.911196595,
       "eth": 23129147.844675913,
       "ltc": 658075636.0044739,
       "bch": 220275225.18218884,
       "bnb": 138717608.28246456,
       "eos": 32590578866.357468,
       "xrp": 104459100842.29274,
       "xlm": 284631732280.0899,
       "link": 5645995658.720585,
       "dot": 4426843325.390545,
       "yfi": 5584256.818438752,
       "usd": 41218709904.85894,
       "aed": 151400443351.53745,
       "ars": 4973999394710.407,
       "aud": 57189517338.14518,
       "bdt": 3677081128463.8643,
       "bhd": 15568966230.42373,
       "bmd": 41218709904.85894,
       "brl": 196819339795.70148,
       "cad": 51917850434.86321,
       "chf": 39642382781.96737,
       "clp": 33461760887863.562,
       "cny": 274528973579.3322,
       "czk": 948405418071.8896,
       "dkk": 286004262416.8452,
       "eur": 38453882500.57074,
       "gbp": 33005346113.087067,
       "hkd": 323352535461.6373,
       "huf": 15070796902513.613,
       "idr": 594930249411781.6,
       "ils": 137671274237.7171,
       "inr": 3202421716122.171,
       "jpy": 5393262097501.263,
       "krw": 51586452007228.164,
       "kwd": 12624342813.530489,
       "lkr": 14888388530512.162,
       "mmk": 76465600977033.83,
       "mxn": 805625867896.9534,
       "myr": 180991355192.2353,
       "ngn": 17139316887691.234,
       "nok": 388958295081.70605,
       "nzd": 62457186026.566284,
       "php": 2180881734972.539,
       "pkr": 8166932893562.157,
       "pln": 176508820490.08234,
       "rub": 2611617706884.1245,
       "sar": 154597572585.30823,
       "sek": 393116644630.4578,
       "sgd": 56633270847.979034,
       "thb": 1413549079044.945,
       "try": 676712291734.0116,
       "twd": 1210799603455.2312,
       "uah": 1214198003649.4678,
       "vef": 4127229422.773526,
       "vnd": 956274069792727.4,
       "zar": 640684047873.923,
       "xdr": 29986405362.2353,
       "xag": 1879561630.4227917,
       "xau": 22267171.46480291,
       "bits": 1389985911196.595,
       "sats": 138998591119659.5
     },
     "market_cap_percentage": {
       "btc": 44.17297164675567,
       "eth": 16.86483718635941,
       "usdt": 5.6765145775953885,
       "usdc": 4.234492181559656,
       "bnb": 3.791617931018069,
       "xrp": 1.491465164773408,
       "ada": 1.477055257257855,
       "busd": 1.4138065343961508,
       "sol": 1.0478984047863629,
       "doge": 0.8471067768279076
     },
     "market_cap_change_percentage_24h_usd": -0.21335732007792355,
     "updated_at": 1654422784
   }
 }
 */

struct GlobalData: Codable {
    let data: MarketData?
}

struct MarketData: Codable {
    let totalMarketCap, totalVolume, marketCapPercentage: [String: Double]
    let marketCapChangePercentage24HUsd: Double
    
    enum CodingKeys: String, CodingKey{
        case totalMarketCap = "total_market_cap"
        case totalVolume = "total_volume"
        case marketCapPercentage = "market_cap_percentage"
        case marketCapChangePercentage24HUsd = "market_cap_change_percentage_24h_usd"
    }
    
    var marketCap: String{
        if let item = totalMarketCap.first(where: { $0.key == "usd"}){
            return "$" + item.value.formattedWithAbbreviations()
        }
        return ""
    }
    
    var volume: String{
        if let item = totalVolume.first(where:{
            $0.key == "usd"
        }){
            return "$" + item.value.formattedWithAbbreviations()

        }
        return ""
    }
    
    var btcDominance: String{
        if let item = marketCapPercentage.first(where: { $0.key == "btc"}){
            return item.value.asPercentString()
        }
        return ""
    }
}
